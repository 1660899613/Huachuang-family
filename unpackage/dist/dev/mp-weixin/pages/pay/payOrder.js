(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/pay/payOrder"],{450:function(n,e,t){"use strict";(function(n){t(5);o(t(3));var e=o(t(451));function o(n){return n&&n.__esModule?n:{default:n}}wx.__webpack_require_UNI_MP_PLUGIN__=t,n(e.default)}).call(this,t(1)["createPage"])},451:function(n,e,t){"use strict";t.r(e);var o=t(452),a=t(454);for(var r in a)"default"!==r&&function(n){t.d(e,n,(function(){return a[n]}))}(r);t(456);var i,c=t(11),s=Object(c["default"])(a["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],i);s.options.__file="pages/pay/payOrder.vue",e["default"]=s.exports},452:function(n,e,t){"use strict";t.r(e);var o=t(453);t.d(e,"render",(function(){return o["render"]})),t.d(e,"staticRenderFns",(function(){return o["staticRenderFns"]})),t.d(e,"recyclableRender",(function(){return o["recyclableRender"]})),t.d(e,"components",(function(){return o["components"]}))},453:function(n,e,t){"use strict";var o;t.r(e),t.d(e,"render",(function(){return a})),t.d(e,"staticRenderFns",(function(){return i})),t.d(e,"recyclableRender",(function(){return r})),t.d(e,"components",(function(){return o}));try{o={uCountDown:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-count-down/u-count-down")]).then(t.bind(null,886))},uImage:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-image/u-image")]).then(t.bind(null,684))},uModal:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-modal/u-modal")]).then(t.bind(null,895))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,736))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var n=this,e=n.$createElement;n._self._c;n._isMounted||(n.e0=function(e){n.paytype="wxpay"},n.e1=function(e){n.paytype="dfpay"},n.e2=function(e){n.show=!1})},r=!1,i=[];a._withStripped=!0},454:function(n,e,t){"use strict";t.r(e);var o=t(455),a=t.n(o);for(var r in o)"default"!==r&&function(n){t.d(e,n,(function(){return o[n]}))}(r);e["default"]=a.a},455:function(n,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t={data:function(){return{show:!1,timeData:{},paytype:"wxpay",transactionId:"",contract_id:"",userInfo:{},fddInfo:{},orderInfo:{},money:null,wechatInfo:{},shareInfor:{}}},onLoad:function(n){console.log(n,"option"),this.transactionId=n.id,this.contract_id=n.contract_id,this.orderId=n.orderId,this.orderStatus=n.orderStatus,this.getUserInfo(),this.shareInfor={userInfo:this.userInfo,fddInfo:this.fddInfo,orderId:this.orderId,contract_id:this.contract_id},console.log(this.transactionId,"this.transactionId")},onShareAppMessage:function(n){return"button"===n.from&&console.log(n),{title:this.$c.miniappName,path:"pages/pay/payOrder?id="+this.transactionId+"&orderId="+this.orderId,imageUrl:this.shareCover}},methods:{getUserInfo:function(){var e=this;n.showLoading({title:"加载中"}),this.$u.api.getUserInfo({}).then((function(t){if(e.userInfo=t.data.userInfo,e.fddInfo=t.data.fddInfo,e.transactionId)return e.onlinepayment(),!1;e.orderId&&(0==e.orderStatus?e.$u.api.onlinepayment({ycy:2,orderId:e.orderId}).then((function(t){console.log(t,"支付信息"),e.wechatInfo=t.data.wechatInfo,e.money=t.data.money,n.hideLoading()})):e.$u.api.onlinepayment({ycy:3,orderId:e.orderId}).then((function(t){console.log(t,"支付信息"),e.wechatInfo=t.data.wechatInfo,e.money=t.data.money,n.hideLoading()}))),console.log(e.fddInfo,e.userInfo,"用户信息")}))},querySignResult:function(){var e=this,t=this,o=this.fddInfo.customerId,a=n.getStorageSync("userAgreementId");this.$u.api.signCode({transaction_id:this.transactionId,customer_id:o,contract_id:a}).then((function(r){console.log(r,"data 合同签署");var i={app_id:e.$c.app_id,timestamp:r.data.timestamp,v:e.$c.v,msg_digest:r.data.signCode,transaction_id:e.transactionId,contract_id:a,customer_id:o};n.request({url:t.$c.fddApiUrl+"api/query_sign_result.api",header:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},data:i,method:"POST",success:function(e){e.data;console.log(e,"合同结果查询...."),3e3==e.data.data.result?t.onlinepayment():n.navigateBack({delta:2})},fail:function(n){console.log(n)}})}))},orderSelect:function(){this.$u.api.orderSelect({ycy:2,orderId:this.orderId}).then((function(n){console.log(n,"1111")}))},onlinepayment:function(){var e=this;this.$u.api.onlinepayment({ycy:1,transactionId:this.transactionId}).then((function(t){console.log(t,"支付信息"),e.wechatInfo=t.data.wechatInfo,e.money=t.data.money,n.hideLoading()}))},onChange:function(n){this.timeData=n},onfinish:function(){var e=this;n.showToast({title:"订单失效",icon:"success",duration:2e3,success:function(){e.$f.jump("/pages/index/index")}})},payOrder:function(){var e=this;if("wxpay"==this.paytype){if(console.log(e.wechatInfo),0==this.money)return void n.showToast({title:"免费课程，无需支付。",icon:"success",duration:1500,success:function(){e.$f.jump("/pages/pay/succ")}});n.requestPayment({provider:"wxpay",orderInfo:e.orderInfo,timeStamp:e.wechatInfo.timestamp,nonceStr:e.wechatInfo.noncestr,package:e.wechatInfo.package,signType:"MD5",paySign:e.wechatInfo.sign,success:function(t){n.showToast({title:"微信支付成功",icon:"success",duration:1500,success:function(){e.$f.jump("/pages/pay/succ")}})},fail:function(e){n.showToast({title:"支付取消",duration:1500,image:"/static/png/error_icon.png"})}})}else e.show=!0}}};e.default=t}).call(this,t(1)["default"])},456:function(n,e,t){"use strict";t.r(e);var o=t(457),a=t.n(o);for(var r in o)"default"!==r&&function(n){t.d(e,n,(function(){return o[n]}))}(r);e["default"]=a.a},457:function(n,e,t){}},[[450,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/pay/payOrder.js.map